<div class="activities_to_invoice">
  <% clients_to_invoice = @uninvoiced_activities.map { |a| a.project.client }.uniq %>
  <% if clients_to_invoice.size == 1 %>
    <% client = clients_to_invoice.first %>
    <%= form_for @invoice, :id => "create_invoice_form" do |f| %>
      <%= hidden_field :client_id, :value => client.id %>
      <fieldset class="new">
        <legend>
          <%= image_tag("icons/notebook_plus.png", :alt => "I") %> Create invoice for <%= client.name %> from selected activities
        </legend>
        <p>
          <%= f.label :name, "Invoice name" %>
          <%= f.text_field :name %>
        </p>
        <p class="buttons">
          <%= submit "Create", :class => "button", :id => "create_invoice_button" %>
        </p>
      </fieldset>

      <fieldset class="existing">
        <legend>
          <%= image_tag("icons/notebook_plus.png", :alt => "I") %> Add selected activities to existing invoice for <%= client.name %>
        </legend>
        <p>
          <%= label :invoice_id, "Invoice" %>
          <%= select_tag :invoice_id, options_from_collection_for_select(client.invoices.pending.all, :id, :name), :include_blank => "Select an invoice..." %>
        </p>
        <p class="buttons">
          <%= submit "Add", :class => "button", :id => "update_invoice_button" %>
        </p>
      </fieldset>
    <% end =%>
  <% else %>
    If you want to create invoice from selected activities please refine your search to include activities for only one client.
  <% end %>
</div>
